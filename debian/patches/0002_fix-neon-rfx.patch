From f1bf99f0755a23ac52c73d4067026f3c6a03c4e5 Mon Sep 17 00:00:00 2001
From: akallabeth <akallabeth@posteo.net>
Date: Tue, 3 May 2022 17:22:11 +0200
Subject: [PATCH] Only build RFX neon path with -DWITH_NEON=ON

(cherry picked from commit d18187c949817b025f76772e065ded7cd5a69a63)
---
 CMakeLists.txt              | 1 -
 libfreerdp/codec/rfx_neon.c | 4 ++--
 2 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index bfdb7a82683..11bd2568ed8 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -600,7 +600,6 @@ if(ANDROID)
 
 	if(ANDROID_ABI STREQUAL arm64-v8a)
 		# https://github.com/android/ndk/issues/910
-		add_definitions(-D__ARM_NEON)
 		set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -mfloat-abi=softfp")
 	endif()
 
diff --git a/libfreerdp/codec/rfx_neon.c b/libfreerdp/codec/rfx_neon.c
index 8a9bd8bcf1c..c41ebb404d6 100644
--- a/libfreerdp/codec/rfx_neon.c
+++ b/libfreerdp/codec/rfx_neon.c
@@ -21,7 +21,7 @@
 #include "config.h"
 #endif
 
-#if defined(__ARM_NEON)
+#if defined(WITH_NEON)
 
 #include <stdio.h>
 #include <stdlib.h>
@@ -241,4 +241,4 @@ void rfx_init_neon(RFX_CONTEXT* context)
 	}
 }
 
-#endif // __ARM_NEON
+#endif // WITH_NEON
